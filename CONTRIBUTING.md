# Guia de Contribui√ß√£o - Sistema ETL de DI's Expertzy

<div align="center">
  <img src="images/expertzy-it.png" alt="Expertzy - Intelig√™ncia Tribut√°ria" height="100">

  **Energia ‚Ä¢ Seguran√ßa ‚Ä¢ Transpar√™ncia**

  Guia completo para desenvolvimento colaborativo do Sistema ETL de DI's
</div>

---

## üìã √çndice

- [Vis√£o Geral do Projeto](#vis√£o-geral-do-projeto)
- [Configura√ß√£o do Ambiente](#configura√ß√£o-do-ambiente)
- [Padr√µes de Desenvolvimento](#padr√µes-de-desenvolvimento)
- [Fluxo de Trabalho Git](#fluxo-de-trabalho-git)
- [Estrutura do C√≥digo](#estrutura-do-c√≥digo)
- [Conven√ß√µes de Nomenclatura](#conven√ß√µes-de-nomenclatura)
- [Testes e Qualidade](#testes-e-qualidade)
- [Documenta√ß√£o](#documenta√ß√£o)
- [Revis√£o de C√≥digo](#revis√£o-de-c√≥digo)
- [Deploy e Releases](#deploy-e-releases)

---

## üéØ Vis√£o Geral do Projeto

### Objetivo
Sistema modular para ETL (Extract, Transform, Load) de XMLs de Declara√ß√µes de Importa√ß√£o brasileiras, com an√°lise fiscal automatizada, precifica√ß√£o inteligente e dashboard din√¢mico.

### Princ√≠pios Fundamentais ‚ö†Ô∏è **OBRIGAT√ìRIOS**
- ‚ùå **No fallbacks, no hardcoded data**
- ‚úÖ **KISS (Keep It Simple, Stupid)**
- ‚úÖ **DRY (Don't Repeat Yourself)** - Nunca duplicar c√≥digos/arquivos/fun√ß√µes
- ‚úÖ **Single Responsibility** - Uma fun√ß√£o, um prop√≥sito
- ‚úÖ **Nomenclatura √önica** - M√≥dulo que cria, nomeia; demais seguem

### Stack Tecnol√≥gico
- **Backend**: PHP 8.1+ (MVC modular)
- **Database**: MySQL 8.0+ otimizado
- **Frontend**: HTML5/CSS3/JavaScript ES6+ padr√£o Expertzy
- **APIs**: RESTful com JWT authentication
- **Versionamento**: Git com GitHub

---

## üõ†Ô∏è Configura√ß√£o do Ambiente

### Pr√©-requisitos
```bash
# Verificar vers√µes m√≠nimas
php --version    # 8.1+
mysql --version  # 8.0+
git --version    # 2.30+
```

### Setup Inicial

#### 1. Clone do Reposit√≥rio
```bash
git clone https://github.com/ceciliodaher/importaco-sistema-etl-dis.git
cd importaco-sistema-etl-dis
```

#### 2. Configura√ß√£o Mac (ServBay)
```bash
# Instalar depend√™ncias
brew install php mysql

# Iniciar servi√ßos
brew services start mysql

# Servidor de desenvolvimento
php -S localhost:8000 -t sistema/
```

#### 3. Configura√ß√£o Windows (WAMP)
```bash
# 1. Instalar WAMP Server
# 2. Copiar projeto para C:\wamp64\www\importaco-sistema\
# 3. Acessar http://localhost/importaco-sistema/
```

#### 4. Banco de Dados
```sql
-- Criar banco
CREATE DATABASE importaco_etl_dis CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- Executar schema (quando dispon√≠vel)
mysql -u root -p importaco_etl_dis < sistema/core/database/schema.sql
```

#### 5. Configura√ß√£o de Ambiente
```php
// sistema/config/environments.php
<?php
if (PHP_OS === 'Darwin') {
    // Configura√ß√£o Mac
    define('DB_HOST', 'localhost');
    define('DB_PORT', 3306);
} elseif (PHP_OS_FAMILY === 'Windows') {
    // Configura√ß√£o Windows
    define('DB_HOST', 'localhost');
    define('DB_PORT', 3306);
}
```

### Verifica√ß√£o da Instala√ß√£o
```bash
# Testar ambiente
php sistema/tests/environment_check.php

# Acessar landing page
open http://localhost:8000  # Mac
start http://localhost/importaco-sistema/  # Windows
```

---

## üìù Padr√µes de Desenvolvimento

### Regras de Neg√≥cio Espec√≠ficas

#### 1. Segmenta√ß√£o de Cliente
```php
// CORRETO: Enum para tipos de cliente
enum ClientType: string {
    case B2B = 'business';
    case B2C = 'consumer';
}

// INCORRETO: Hardcode
if ($client === 'revenda') { ... }  // ‚ùå
```

#### 2. C√°lculo de Markup
```php
// CORRETO: Baseado em landed cost
$markup = $this->calculateMarkup($landedCost, $clientSegment);

// INCORRETO: Valores fixos
$markup = $cost * 1.30;  // ‚ùå
```

#### 3. L√≥gica por Estado
```php
// CORRETO: Configur√°vel
$benefits = $this->stateConfig->getBenefits($state, $ncm);

// INCORRETO: Hardcode por estado
if ($state === 'GO') { $icms = 0.02; }  // ‚ùå
```

#### 4. Parsing XML
```php
// CORRETO: Parser flex√≠vel
$di = $this->xmlParser->parseDI($xmlContent);

// INCORRETO: XPath fixo
$value = $xml->xpath('//declaracao/adicao[1]/valor')[0];  // ‚ùå
```

#### 5. M√∫ltiplas Moedas
```php
// CORRETO: Taxa calculada dos valores DI
$exchangeRate = $this->calculateExchangeRate($vmle, $vmcv, $currency);

// INCORRETO: Taxa externa
$rate = $this->getExternalRate('USD');  // ‚ùå
```

### Padr√µes de C√≥digo PHP

#### Estrutura de Classes
```php
<?php
namespace Expertzy\Core\Calculators;

use Expertzy\Core\Interfaces\CalculatorInterface;
use Expertzy\Core\Exceptions\CalculationException;

/**
 * Calculadora de c√¢mbio din√¢mica baseada em valores DI
 *
 * @package Expertzy\Core\Calculators
 * @author Sistema Expertzy
 * @since 1.0.0
 */
class CurrencyCalculator implements CalculatorInterface
{
    private NomenclatureRegistry $nomenclature;

    public function __construct(NomenclatureRegistry $nomenclature)
    {
        $this->nomenclature = $nomenclature;
    }

    /**
     * Calcula taxa de c√¢mbio a partir dos valores VMLE/VMCV da DI
     *
     * @param float $vmle Valor da mercadoria no local de embarque
     * @param float $vmcv Valor da mercadoria na condi√ß√£o de venda
     * @param string $currency C√≥digo ISO da moeda
     * @return float Taxa de c√¢mbio calculada
     * @throws CalculationException
     */
    public function calculateExchangeRate(float $vmle, float $vmcv, string $currency): float
    {
        if ($vmle <= 0 || $vmcv <= 0) {
            throw new CalculationException('Valores VMLE/VMCV devem ser positivos');
        }

        // Implementa√ß√£o espec√≠fica
        return $this->performCalculation($vmle, $vmcv, $currency);
    }
}
```

#### Conven√ß√µes de Nomenclatura
```php
// Classes: PascalCase
class TaxCalculator { }
class DiXmlParser { }

// M√©todos: camelCase
public function calculateImportTax() { }
public function parseXmlDi() { }

// Vari√°veis: camelCase
$exchangeRate = 5.50;
$importTaxValue = 1000.00;

// Constantes: UPPER_SNAKE_CASE
const MAX_PROCESSING_TIME = 30;
const DEFAULT_CURRENCY = 'BRL';

// Arquivos: kebab-case
di-xml-parser.php
tax-calculator.php
```

### Padr√µes Frontend

#### HTML Estrutural
```html
<!-- CORRETO: Sem√¢ntico e acess√≠vel -->
<section class="etl-dashboard">
    <header class="dashboard-header">
        <h1>Dashboard ETL</h1>
    </header>
    <main class="dashboard-content">
        <article class="module-fiscal">
            <h2>M√≥dulo Fiscal</h2>
        </article>
    </main>
</section>
```

#### CSS Modular
```css
/* CORRETO: Nomenclatura BEM */
.module-fiscal { }
.module-fiscal__header { }
.module-fiscal__content { }
.module-fiscal--active { }

/* Vari√°veis CSS Expertzy */
:root {
    --expertzy-red: #FF002D;
    --expertzy-dark: #091A30;
    --expertzy-white: #FFFFFF;
}
```

#### JavaScript ES6+
```javascript
// CORRETO: M√≥dulos ES6
class ExpertzyModule {
    constructor(config) {
        this.config = config;
        this.nomenclature = new NomenclatureRegistry();
    }

    async processData(data) {
        try {
            const result = await this.validateAndProcess(data);
            return this.formatResponse(result);
        } catch (error) {
            this.logError('PROCESSING_ERROR', error);
            throw error;
        }
    }
}

// Export/Import
export { ExpertzyModule };
import { ExpertzyModule } from './expertzy-module.js';
```

---

## üîÑ Fluxo de Trabalho Git

### Estrutura de Branches

```
master (main)           # Produ√ß√£o est√°vel
‚îú‚îÄ‚îÄ develop            # Integra√ß√£o de features
‚îú‚îÄ‚îÄ feature/tax-engine # Feature espec√≠fica
‚îú‚îÄ‚îÄ feature/xml-parser # Feature espec√≠fica
‚îú‚îÄ‚îÄ hotfix/urgent-bug  # Corre√ß√µes urgentes
‚îî‚îÄ‚îÄ release/v1.0.0     # Prepara√ß√£o release
```

### Processo de Desenvolvimento

#### 1. Criar Feature Branch
```bash
# Sempre partir da develop
git checkout develop
git pull origin develop

# Criar feature branch
git checkout -b feature/currency-calculator
```

#### 2. Desenvolvimento
```bash
# Commits frequentes e pequenos
git add .
git commit -m "feat: adiciona base currency calculator"

git add src/calculators/
git commit -m "feat: implementa c√°lculo taxa c√¢mbio DI"

git add tests/
git commit -m "test: adiciona testes currency calculator"
```

#### 3. Pull Request
```bash
# Push da feature
git push origin feature/currency-calculator

# Criar PR via GitHub
# Target: develop
# Reviewers: obrigat√≥rio 1+ aprova√ß√£o
```

#### 4. Merge e Cleanup
```bash
# Ap√≥s aprova√ß√£o, merge via GitHub
# Deletar branch local
git checkout develop
git pull origin develop
git branch -d feature/currency-calculator
```

### Conven√ß√µes de Commit

#### Formato Obrigat√≥rio
```
<type>(<scope>): <description>

[optional body]

[optional footer]
```

#### Tipos Permitidos
- **feat**: Nova funcionalidade
- **fix**: Corre√ß√£o de bug
- **docs**: Documenta√ß√£o
- **style**: Formata√ß√£o, sem mudan√ßa l√≥gica
- **refactor**: Refatora√ß√£o de c√≥digo
- **test**: Adicionar/modificar testes
- **chore**: Tarefas de build, configura√ß√£o

#### Exemplos
```bash
# Features
git commit -m "feat(tax): adiciona c√°lculo ICMS por estado"
git commit -m "feat(parser): implementa parse XML DI brasileiras"

# Fixes
git commit -m "fix(currency): corrige c√°lculo taxa m√∫ltiplas moedas"
git commit -m "fix(api): resolve erro 500 em POST /calculate"

# Docs
git commit -m "docs: atualiza README com setup Windows"
git commit -m "docs(api): adiciona documenta√ß√£o endpoints"

# Tests
git commit -m "test(parser): adiciona casos teste XML inv√°lido"
```

---

## üèóÔ∏è Estrutura do C√≥digo

### Organiza√ß√£o de Diret√≥rios

```
/importaco-sistema/
‚îú‚îÄ‚îÄ README.md                    # Documenta√ß√£o principal
‚îú‚îÄ‚îÄ CONTRIBUTING.md              # Este arquivo
‚îú‚îÄ‚îÄ CLAUDE.md                    # Configura√ß√µes projeto
‚îú‚îÄ‚îÄ index.html                   # Landing page
‚îú‚îÄ‚îÄ assets/                      # Assets landing page
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.css            # Estilos principais
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ expertzy-theme.css  # Tema da marca
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îú‚îÄ‚îÄ main.js             # JavaScript principal
‚îÇ       ‚îî‚îÄ‚îÄ expertzy-interactions.js # Intera√ß√µes marca
‚îú‚îÄ‚îÄ sistema/                     # Sistema principal
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.php        # Configura√ß√£o BD
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ environments.php    # Ambientes (Mac/Windows/Web)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ nomenclature.php    # Registry central nomenclatura
‚îÇ   ‚îú‚îÄ‚îÄ core/                   # Componentes centrais
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ parsers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DiXmlParser.php # Parser √∫nico DI brasileiras
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ calculators/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CurrencyCalculator.php # C√¢mbio calculado
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TaxCalculator.php      # Engine fiscal
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MarkupCalculator.php   # Precifica√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ engines/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IncentivesEngine.php   # Benef√≠cios fiscais
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CostEngine.php         # Custeio completo
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ schema.sql             # Schema MySQL √∫nico
‚îÇ   ‚îú‚îÄ‚îÄ modules/                # M√≥dulos especializados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fiscal/             # M√≥dulo Fiscal (cria nomenclatura)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commercial/         # M√≥dulo Comercial
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ accounting/         # M√≥dulo Cont√°bil
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ billing/            # M√≥dulo Faturamento
‚îÇ   ‚îú‚îÄ‚îÄ shared/                 # Componentes compartilhados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/         # Componentes reutiliz√°veis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/              # Utilit√°rios
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ assets/             # CSS/JS padr√£o sistema
‚îÇ   ‚îî‚îÄ‚îÄ data/                   # Dados do sistema
‚îÇ       ‚îú‚îÄ‚îÄ uploads/            # XMLs carregados
‚îÇ       ‚îú‚îÄ‚îÄ processed/          # Dados processados
‚îÇ       ‚îî‚îÄ‚îÄ exports/            # Relat√≥rios gerados
‚îî‚îÄ‚îÄ docs/                       # Documenta√ß√£o t√©cnica
    ‚îú‚îÄ‚îÄ api/                    # Documenta√ß√£o APIs
    ‚îú‚îÄ‚îÄ database/               # Documenta√ß√£o BD
    ‚îî‚îÄ‚îÄ modules/                # Documenta√ß√£o m√≥dulos
```

### Regras de Organiza√ß√£o

#### 1. Separa√ß√£o de Responsabilidades
```php
// CORRETO: Cada classe uma responsabilidade
class DiXmlParser { }      // Apenas parse XML
class TaxCalculator { }    // Apenas c√°lculos fiscais
class DatabaseLogger { }   // Apenas logs BD

// INCORRETO: Classe "deus"
class DiProcessor {        // ‚ùå Faz tudo
    public function parseXml() { }
    public function calculateTax() { }
    public function saveDatabase() { }
    public function generateReport() { }
}
```

#### 2. Nomenclatura Hier√°rquica
```php
// CORRETO: M√≥dulo Fiscal define nomenclatura
namespace Expertzy\Modules\Fiscal;
class NomenclatureCreator {
    public function defineNcmCode(string $code): string { }
    public function defineCfopCode(string $code): string { }
}

// CORRETO: Outros m√≥dulos consultam
namespace Expertzy\Modules\Commercial;
class PricingEngine {
    public function __construct(NomenclatureRegistry $registry) {
        $this->nomenclature = $registry; // Usa defini√ß√µes do Fiscal
    }
}
```

#### 3. APIs RESTful Padronizadas
```php
// Estrutura padr√£o endpoints
GET    /api/v1/etl/status/{id}      # Status processamento
POST   /api/v1/etl/upload           # Upload XML DI
POST   /api/v1/fiscal/calculate     # C√°lculos tribut√°rios
GET    /api/v1/commercial/pricing   # Consulta pre√ßos
POST   /api/v1/accounting/costs     # Rateio custos
GET    /api/v1/billing/croqui/{id}  # Gerar croqui
```

---

## üîß Conven√ß√µes de Nomenclatura

### Sistema de Nomenclatura √önico ‚ö†Ô∏è **CR√çTICO**

#### Regra Fundamental
> **"M√≥dulo que cria, nomeia - demais seguem"**

#### Hierarquia de Nomenclatura
```
M√≥dulo Fiscal (CREATOR) üëë
‚îú‚îÄ‚îÄ Define: NCM, CFOP, CST, Regimes Tribut√°rios
‚îú‚îÄ‚îÄ Valida: C√≥digos fiscais, al√≠quotas
‚îî‚îÄ‚îÄ Exporta: NomenclatureRegistry

M√≥dulo Comercial (CONSUMER)
‚îú‚îÄ‚îÄ Importa: NomenclatureRegistry do Fiscal
‚îú‚îÄ‚îÄ Usa: C√≥digos definidos pelo Fiscal
‚îî‚îÄ‚îÄ N√ÉO cria: Nomenclaturas pr√≥prias

M√≥dulo Cont√°bil (CONSUMER)
‚îú‚îÄ‚îÄ Importa: NomenclatureRegistry do Fiscal
‚îú‚îÄ‚îÄ Usa: C√≥digos definidos pelo Fiscal
‚îî‚îÄ‚îÄ N√ÉO cria: Nomenclaturas pr√≥prias

M√≥dulo Faturamento (CONSUMER)
‚îú‚îÄ‚îÄ Importa: NomenclatureRegistry do Fiscal
‚îú‚îÄ‚îÄ Usa: C√≥digos definidos pelo Fiscal
‚îî‚îÄ‚îÄ N√ÉO cria: Nomenclaturas pr√≥prias
```

#### Implementa√ß√£o Pr√°tica
```php
// FISCAL MODULE - CREATOR
namespace Expertzy\Modules\Fiscal;

class NomenclatureCreator {
    public function createNcmDefinition(string $code, array $data): NcmDefinition {
        // Fiscal module CRIA a defini√ß√£o
        return new NcmDefinition($code, $data);
    }

    public function registerToGlobalRegistry(NcmDefinition $definition): void {
        NomenclatureRegistry::getInstance()->register('ncm', $definition);
    }
}

// COMMERCIAL MODULE - CONSUMER
namespace Expertzy\Modules\Commercial;

class PricingEngine {
    public function getPricingByNcm(string $ncmCode): Price {
        // Commercial module USA defini√ß√£o do Fiscal
        $ncmDef = NomenclatureRegistry::getInstance()->get('ncm', $ncmCode);
        return $this->calculatePrice($ncmDef);
    }
}
```

### Conven√ß√µes por Tipo

#### 1. Classes e Interfaces
```php
// Classes: PascalCase + sufixo descritivo
DiXmlParser           # Parser de DI
TaxCalculatorEngine   # Engine de c√°lculo
IncentivesManager     # Gerenciador de incentivos

// Interfaces: PascalCase + Interface
CalculatorInterface   # Interface para calculadoras
ParserInterface       # Interface para parsers
EngineInterface       # Interface para engines

// Abstracts: PascalCase + Abstract
AbstractCalculator    # Calculadora base
AbstractParser        # Parser base
```

#### 2. M√©todos e Vari√°veis
```php
// M√©todos: camelCase + verbo + objeto
calculateImportTax()     # Calcula imposto importa√ß√£o
parseXmlDiContent()      # Parse conte√∫do XML DI
generateCostReport()     # Gera relat√≥rio custos

// Vari√°veis: camelCase + substantivo
$exchangeRate           # Taxa de c√¢mbio
$importTaxValue         # Valor imposto importa√ß√£o
$diProcessingResult     # Resultado processamento DI

// Booleanos: is/has/can + adjetivo
$isValidXml            # XML √© v√°lido
$hasIncentives         # Tem incentivos
$canProcessDi          # Pode processar DI
```

#### 3. Constantes e Configura√ß√µes
```php
// Constantes: UPPER_SNAKE_CASE
const MAX_XML_SIZE = 50 * 1024 * 1024;  # 50MB
const DEFAULT_CURRENCY = 'BRL';
const TAX_CALCULATION_TIMEOUT = 30;     # segundos

// Configura√ß√µes: snake_case
$config['database_host'] = 'localhost';
$config['upload_max_size'] = '50M';
$config['cache_ttl'] = 3600;
```

#### 4. Arquivos e Diret√≥rios
```php
// PHP: kebab-case.php
di-xml-parser.php
tax-calculator-engine.php
currency-calculator.php

// CSS: kebab-case.css
expertzy-theme.css
module-fiscal.css
dashboard-components.css

// JS: kebab-case.js
main-application.js
expertzy-interactions.js
module-commercial.js

// Diret√≥rios: kebab-case
/modules/fiscal/
/shared/components/
/core/calculators/
```

---

## ‚úÖ Testes e Qualidade

### Estrat√©gia de Testes

#### 1. Pir√¢mide de Testes
```
                 /\
                /  \  E2E (5%)
               /____\
              /      \
             / Integration (15%)
            /__________\
           /            \
          /  Unit Tests   \  (80%)
         /________________\
```

#### 2. Estrutura de Testes
```
/tests/
‚îú‚îÄ‚îÄ unit/                       # Testes unit√°rios
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ parsers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DiXmlParserTest.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ calculators/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CurrencyCalculatorTest.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TaxCalculatorTest.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ engines/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ IncentivesEngineTest.php
‚îÇ   ‚îî‚îÄ‚îÄ modules/
‚îÇ       ‚îú‚îÄ‚îÄ fiscal/
‚îÇ       ‚îú‚îÄ‚îÄ commercial/
‚îÇ       ‚îú‚îÄ‚îÄ accounting/
‚îÇ       ‚îî‚îÄ‚îÄ billing/
‚îú‚îÄ‚îÄ integration/                # Testes integra√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ modules/
‚îú‚îÄ‚îÄ e2e/                       # Testes end-to-end
‚îÇ   ‚îú‚îÄ‚îÄ complete-di-processing/
‚îÇ   ‚îî‚îÄ‚îÄ user-workflows/
‚îî‚îÄ‚îÄ fixtures/                  # Dados de teste
    ‚îú‚îÄ‚îÄ xml-samples/
    ‚îú‚îÄ‚îÄ expected-outputs/
    ‚îî‚îÄ‚îÄ mock-data/
```

#### 3. Padr√µes de Teste Unit√°rio
```php
<?php
namespace Tests\Unit\Core\Calculators;

use PHPUnit\Framework\TestCase;
use Expertzy\Core\Calculators\CurrencyCalculator;
use Expertzy\Core\Exceptions\CalculationException;

class CurrencyCalculatorTest extends TestCase
{
    private CurrencyCalculator $calculator;

    protected function setUp(): void
    {
        $this->calculator = new CurrencyCalculator();
    }

    /**
     * @test
     * @dataProvider validCurrencyDataProvider
     */
    public function deve_calcular_taxa_cambio_corretamente(
        float $vmle,
        float $vmcv,
        string $currency,
        float $expectedRate
    ): void {
        // Arrange (Setup j√° feito)

        // Act
        $actualRate = $this->calculator->calculateExchangeRate($vmle, $vmcv, $currency);

        // Assert
        $this->assertEquals($expectedRate, $actualRate, '', 0.001);
    }

    /**
     * @test
     */
    public function deve_lancar_excecao_para_valores_invalidos(): void
    {
        // Arrange & Assert
        $this->expectException(CalculationException::class);
        $this->expectExceptionMessage('Valores VMLE/VMCV devem ser positivos');

        // Act
        $this->calculator->calculateExchangeRate(-100, 200, 'USD');
    }

    public function validCurrencyDataProvider(): array
    {
        return [
            'USD b√°sico' => [1000.00, 5500.00, 'USD', 5.50],
            'EUR b√°sico' => [1000.00, 6000.00, 'EUR', 6.00],
            'CNY b√°sico' => [1000.00, 800.00, 'CNY', 0.80],
        ];
    }
}
```

#### 4. Cobertura de Testes
```bash
# Executar testes com cobertura
./vendor/bin/phpunit --coverage-html coverage/

# M√©tricas obrigat√≥rias
# - Cobertura geral: > 90%
# - Core components: 100%
# - Calculators: 100%
# - Parsers: 100%
```

### Qualidade de C√≥digo

#### 1. An√°lise Est√°tica
```bash
# PHPStan (an√°lise est√°tica)
./vendor/bin/phpstan analyse src/ --level=8

# PHP_CodeSniffer (padr√µes c√≥digo)
./vendor/bin/phpcs --standard=PSR12 src/

# PHP-CS-Fixer (formata√ß√£o autom√°tica)
./vendor/bin/php-cs-fixer fix src/
```

#### 2. M√©tricas de Qualidade
```php
// Complexidade ciclom√°tica: < 10
// Linhas por m√©todo: < 50
// Par√¢metros por m√©todo: < 7
// N√≠vel de heran√ßa: < 5

class GoodExample {
    public function calculateSimpleTax(float $value, float $rate): float
    {
        if ($value <= 0 || $rate < 0) {
            throw new InvalidArgumentException('Valores inv√°lidos');
        }

        return $value * $rate;
    }
}
```

#### 3. Performance Benchmarks
```php
/**
 * @test
 * @group performance
 */
public function deve_processar_xml_em_menos_de_30_segundos(): void
{
    // Arrange
    $startTime = microtime(true);
    $xmlContent = file_get_contents('fixtures/large-di.xml');

    // Act
    $result = $this->parser->parseXml($xmlContent);

    // Assert
    $processingTime = microtime(true) - $startTime;
    $this->assertLessThan(30, $processingTime, 'Processamento deve ser < 30s');
    $this->assertNotNull($result);
}
```

---

## üìö Documenta√ß√£o

### Documenta√ß√£o de C√≥digo

#### 1. PHPDoc Obrigat√≥rio
```php
/**
 * Calcula impostos de importa√ß√£o baseado no regime tribut√°rio
 *
 * Este m√©todo aplica as regras fiscais espec√≠ficas para cada regime
 * (Real, Presumido, Simples) e considera benef√≠cios por estado.
 *
 * @param float $value Valor base para c√°lculo (em BRL)
 * @param string $regime Regime tribut√°rio: 'real', 'presumido', 'simples'
 * @param string $state C√≥digo UF (ex: 'GO', 'SC', 'ES')
 * @param string $ncm C√≥digo NCM do produto
 *
 * @return TaxCalculationResult Resultado com todos os impostos calculados
 *
 * @throws CalculationException Quando par√¢metros s√£o inv√°lidos
 * @throws UnsupportedRegimeException Quando regime n√£o √© suportado
 *
 * @example
 * ```php
 * $result = $calculator->calculateImportTax(
 *     value: 10000.00,
 *     regime: 'real',
 *     state: 'GO',
 *     ncm: '84091000'
 * );
 * ```
 *
 * @see TaxCalculationResult Para estrutura do resultado
 * @see https://expertzy.com.br/docs/tax-calculation Para documenta√ß√£o completa
 *
 * @since 1.0.0
 * @author Sistema Expertzy
 */
public function calculateImportTax(
    float $value,
    string $regime,
    string $state,
    string $ncm
): TaxCalculationResult {
    // Implementa√ß√£o
}
```

#### 2. README por M√≥dulo
```markdown
# M√≥dulo Fiscal - Documenta√ß√£o

## Responsabilidades
- C√°lculos tribut√°rios (II, IPI, PIS/COFINS, ICMS)
- Cria√ß√£o de nomenclatura fiscal padr√£o
- Aplica√ß√£o de benef√≠cios fiscais por estado

## APIs Principais
- `POST /api/v1/fiscal/calculate` - Calcular impostos
- `GET /api/v1/fiscal/regimes` - Listar regimes
- `POST /api/v1/fiscal/incentives` - Aplicar incentivos

## Configura√ß√£o
```php
$config = [
    'regimes' => ['real', 'presumido', 'simples'],
    'states' => ['GO', 'SC', 'ES', 'MG'],
    'cache_ttl' => 3600
];
```

## Exemplos de Uso
[Exemplos pr√°ticos aqui]
```

#### 3. Documenta√ß√£o de APIs
```yaml
# OpenAPI 3.0 spec
openapi: 3.0.0
info:
  title: Sistema ETL DI's API
  version: 1.0.0
  description: APIs para processamento de DI's

paths:
  /api/v1/fiscal/calculate:
    post:
      summary: Calcular impostos de importa√ß√£o
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                value:
                  type: number
                  format: float
                  example: 10000.00
                regime:
                  type: string
                  enum: [real, presumido, simples]
                  example: "real"
```

### Wiki e Conhecimento

#### 1. Estrutura Wiki
```
/docs/wiki/
‚îú‚îÄ‚îÄ onboarding/
‚îÇ   ‚îú‚îÄ‚îÄ setup-ambiente.md
‚îÇ   ‚îú‚îÄ‚îÄ primeira-contribuicao.md
‚îÇ   ‚îî‚îÄ‚îÄ arquitetura-overview.md
‚îú‚îÄ‚îÄ tutoriais/
‚îÇ   ‚îú‚îÄ‚îÄ como-adicionar-modulo.md
‚îÇ   ‚îú‚îÄ‚îÄ como-criar-calculadora.md
‚îÇ   ‚îî‚îÄ‚îÄ como-testar-xml-parser.md
‚îú‚îÄ‚îÄ troubleshooting/
‚îÇ   ‚îú‚îÄ‚îÄ problemas-comuns.md
‚îÇ   ‚îú‚îÄ‚îÄ debug-guia.md
‚îÇ   ‚îî‚îÄ‚îÄ performance-issues.md
‚îî‚îÄ‚îÄ rfcs/
    ‚îú‚îÄ‚îÄ rfc-001-nomenclature-system.md
    ‚îú‚îÄ‚îÄ rfc-002-currency-calculation.md
    ‚îî‚îÄ‚îÄ rfc-003-module-communication.md
```

#### 2. Changelog Estruturado
```markdown
# Changelog

## [1.1.0] - 2025-10-15

### Added
- Suporte a m√∫ltiplas moedas no XML parser
- C√°lculo autom√°tico de taxa de c√¢mbio
- Dashboard de an√°lise em tempo real

### Changed
- Refatora√ß√£o do sistema de nomenclatura
- Otimiza√ß√£o de performance em 40%
- Atualiza√ß√£o documenta√ß√£o APIs

### Fixed
- Corre√ß√£o bug c√°lculo ICMS Santa Catarina
- Resolu√ß√£o erro timeout em XMLs grandes
- Fix valida√ß√£o campos obrigat√≥rios DI

### Security
- Implementa√ß√£o rate limiting APIs
- Valida√ß√£o rigorosa inputs XML
- Auditoria completa de opera√ß√µes
```

---

## üîç Revis√£o de C√≥digo

### Processo de Code Review

#### 1. Checklist Obrigat√≥rio
```markdown
## ‚úÖ Checklist Review

### Funcionalidade
- [ ] Feature funciona conforme especificado
- [ ] Casos edge tratados adequadamente
- [ ] Valida√ß√£o de inputs implementada
- [ ] Error handling apropriado

### C√≥digo
- [ ] Segue padr√µes de nomenclatura
- [ ] N√£o duplica c√≥digo existente
- [ ] Complexidade ciclom√°tica < 10
- [ ] M√©todos com < 50 linhas

### Testes
- [ ] Testes unit√°rios adicionados
- [ ] Cobertura > 90%
- [ ] Casos edge testados
- [ ] Performance testada

### Documenta√ß√£o
- [ ] PHPDoc completo
- [ ] README atualizado se necess√°rio
- [ ] Changelog atualizado
- [ ] APIs documentadas

### Seguran√ßa
- [ ] Inputs sanitizados
- [ ] SQL injection prevenido
- [ ] Dados sens√≠veis protegidos
- [ ] Logs sem informa√ß√µes sens√≠veis
```

#### 2. Crit√©rios de Aprova√ß√£o
```markdown
## üéØ Crit√©rios Aprova√ß√£o

### Obrigat√≥rios (Blocking)
- ‚úÖ Todos os testes passando
- ‚úÖ Cobertura > 90%
- ‚úÖ An√°lise est√°tica sem erros
- ‚úÖ 1+ aprova√ß√£o de reviewer senior

### Recomendados (Non-blocking)
- üìù Documenta√ß√£o completa
- üöÄ Performance otimizada
- üîí Seguran√ßa validada
- üìä M√©tricas de qualidade OK
```

#### 3. Templates de Review
```markdown
## üîç Review Template

### Resumo
Breve descri√ß√£o das altera√ß√µes e impacto.

### Pontos Positivos ‚úÖ
- Implementa√ß√£o clara e objetiva
- Boa cobertura de testes
- Documenta√ß√£o adequada

### Pontos de Melhoria üîß
- [ ] Refatorar m√©todo X para reduzir complexidade
- [ ] Adicionar valida√ß√£o Y
- [ ] Melhorar error message Z

### Perguntas ‚ùì
- Por que escolheu implementa√ß√£o X ao inv√©s de Y?
- Considerou o impacto na performance?

### Decis√£o
- [ ] Aprovado ‚úÖ
- [ ] Aprovado com ressalvas ‚ö†Ô∏è
- [ ] Precisa altera√ß√µes ‚ùå
```

---

## üöÄ Deploy e Releases

### Estrat√©gia de Deploy

#### 1. Ambientes
```
Development  ‚Üí Develop branch
Staging      ‚Üí Release branch
Production   ‚Üí Master branch
```

#### 2. Pipeline CI/CD
```yaml
# .github/workflows/ci.yml
name: CI/CD Pipeline

on:
  push:
    branches: [ develop, master ]
  pull_request:
    branches: [ develop ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.1'
      - name: Install dependencies
        run: composer install
      - name: Run tests
        run: ./vendor/bin/phpunit
      - name: Static analysis
        run: ./vendor/bin/phpstan analyse
```

#### 3. Versionamento Sem√¢ntico
```
MAJOR.MINOR.PATCH

1.0.0 ‚Üí 1.0.1 (patch: bug fixes)
1.0.1 ‚Üí 1.1.0 (minor: new features)
1.1.0 ‚Üí 2.0.0 (major: breaking changes)
```

### Processo de Release

#### 1. Prepara√ß√£o Release
```bash
# 1. Criar release branch
git checkout develop
git pull origin develop
git checkout -b release/v1.1.0

# 2. Atualizar vers√µes
echo "1.1.0" > VERSION
# Atualizar composer.json, package.json, etc.

# 3. Executar testes completos
./scripts/run-all-tests.sh

# 4. Gerar changelog
./scripts/generate-changelog.sh

# 5. Commit release
git add .
git commit -m "chore: prepare release v1.1.0"
```

#### 2. Deploy Production
```bash
# 1. Merge para master
git checkout master
git merge release/v1.1.0

# 2. Tag da release
git tag -a v1.1.0 -m "Release v1.1.0"

# 3. Push
git push origin master
git push origin v1.1.0

# 4. Deploy autom√°tico via CI/CD
```

#### 3. Rollback de Emerg√™ncia
```bash
# Em caso de problemas cr√≠ticos
git checkout master
git revert HEAD
git push origin master

# Ou rollback para vers√£o anterior
git reset --hard v1.0.0
git push origin master --force-with-lease
```

---

## üÜò Suporte e Troubleshooting

### Canais de Comunica√ß√£o

#### 1. GitHub Issues
```markdown
## üêõ Bug Report Template

### Descri√ß√£o
Descri√ß√£o clara e concisa do bug.

### Reprodu√ß√£o
Passos para reproduzir:
1. Acesse '...'
2. Clique em '...'
3. Erro aparece

### Comportamento Esperado
O que deveria acontecer.

### Screenshots
Se aplic√°vel, adicione screenshots.

### Ambiente
- OS: [ex. Windows 10, macOS 12]
- Browser: [ex. Chrome 96, Safari 15]
- Vers√£o: [ex. v1.0.0]

### Logs
```
[Cole logs relevantes aqui]
```

### Contexto Adicional
Qualquer informa√ß√£o adicional sobre o problema.
```

#### 2. Debugging Guide
```markdown
## üîß Debug Guide

### PHP Errors
```bash
# Ativar debug mode
export APP_DEBUG=true

# Verificar logs
tail -f sistema/data/logs/error.log

# Debug espec√≠fico
php -d display_errors=1 script.php
```

### Database Issues
```sql
-- Verificar conex√£o
SELECT 1;

-- Verificar tabelas
SHOW TABLES;

-- Verificar √≠ndices
SHOW INDEX FROM dis;
```

### Performance Issues
```bash
# Profile PHP
php -d xdebug.mode=profile script.php

# Monitor MySQL
SHOW PROCESSLIST;

# Verificar memoria
php -d memory_limit=-1 script.php
```
```

### Contatos de Emerg√™ncia

#### 1. Escala√ß√£o
```
N√≠vel 1: GitHub Issues
N√≠vel 2: Email direto
N√≠vel 3: Telefone emerg√™ncia
```

#### 2. Hor√°rios de Suporte
```
Business Hours: 08:00 - 18:00 (GMT-3)
Emergency: 24/7 para bugs cr√≠ticos
Response Time: < 4h business hours
```

---

## üìû Contatos e Recursos

### Links Importantes
- **Reposit√≥rio**: https://github.com/ceciliodaher/importaco-sistema-etl-dis
- **Documenta√ß√£o**: https://github.com/ceciliodaher/importaco-sistema-etl-dis/wiki
- **Issues**: https://github.com/ceciliodaher/importaco-sistema-etl-dis/issues
- **Releases**: https://github.com/ceciliodaher/importaco-sistema-etl-dis/releases

### Ferramentas Recomendadas
- **IDE**: VSCode, PhpStorm
- **Git GUI**: GitKraken, Sourcetree
- **Database**: phpMyAdmin, MySQL Workbench
- **API Testing**: Postman, Insomnia

---

<div align="center">

### üéØ **Lembre-se**: KISS + DRY + Nomenclatura √önica

**Energia ‚Ä¢ Velocidade ‚Ä¢ For√ßa | Seguran√ßa ‚Ä¢ Intelecto ‚Ä¢ Precis√£o | Respeito ‚Ä¢ Prote√ß√£o ‚Ä¢ Transpar√™ncia**

¬© 2025 Sistema ETL de DI's - Padr√£o Expertzy

</div>